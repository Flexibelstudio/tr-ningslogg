<!DOCTYPE html>
<html lang="sv-SE">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Träningslogg</title>

  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/icon-180x180.png">
  <meta name="theme-color" content="#3bab5a">

  <style>
    @keyframes confetti-fall {
      0%   { transform: translateY(0) rotateZ(0deg) rotateY(0deg); opacity: 1; }
      100% { transform: translateY(110vh) rotateZ(720deg) rotateY(360deg); opacity: 0; }
    }
    .confetti {
      position: fixed;
      top: -20px;
      animation-name: confetti-fall;
      animation-timing-function: linear;
      animation-iteration-count: 1;
      will-change: transform, opacity;
    }
  </style>

  <!-- För bygg/“riktig” app: den här filen kommer att finnas och vara minifierad -->
  <link id="tw-built" rel="stylesheet" href="/index.css" />

  <!-- Fallback: om byggd CSS saknas (t.ex. AI Studio-preview), ladda Tailwind CDN -->
  <script>
  (function () {
    const FORCE_CDN = location.search.includes('tailwind=cdn') || localStorage.getItem('tw:mode') === 'cdn';
    let cdnLoaded = false;

    function loadCdn() {
      if (cdnLoaded) return;
      cdnLoaded = true;
      
      // Konfigurera tailwind.config här för custom theme i CDN-läget
      window.tailwind = {
        theme: {
          extend: {
            backgroundImage: { 'dotted-pattern': "radial-gradient(hsl(215 20% 85%) 1px, transparent 0)", },
            backgroundSize: { 'dotted-size': '25px 25px', },
            colors: {
              flexibel: '#3bab5a',
              'flexibel-orange': '#f97316',
              slate: { 50: '#f8fafc', 100: '#f1f5f9', 200: '#e2e8f0', 300: '#cbd5e1', 400: '#94a3b8', 500: '#64748b', 600: '#475569', 700: '#334155', 800: '#1e293b', 900: '#0f172a', },
              blue: { 500: '#3b82f6' }
            },
            animation: { 'fade-in-down': 'fadeInDown 0.5s ease-out', 'pulse-cta': 'pulse-cta 2.5s cubic-bezier(0.4, 0, 0.6, 1) infinite', 'pulse-icon': 'pulse-icon 1.5s ease-in-out infinite', 'fade-in': 'fadeIn 0.3s ease-out', 'scale-in': 'scaleIn 0.2s ease-out', 'highlight-new': 'highlight-fade 3s ease-out' },
            keyframes: {
              fadeInDown: { '0%': { opacity: '0', transform: 'translateY(-10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' }, },
              'pulse-cta': { '0%, 100%': { transform: 'scale(1)' }, '50%': { transform: 'scale(1.05)' }, },
              'pulse-icon': { '0%, 100%': { transform: 'scale(1)', opacity: '1' }, '50%': { transform: 'scale(1.25)', opacity: '0.75' }, },
              fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' }, },
              scaleIn: { '0%': { opacity: '0', transform: 'scale(0.95)' }, '100%': { opacity: '1', transform: 'scale(1)' }, },
              'highlight-fade': { '0%': { backgroundColor: '#dcfce7' }, '100%': { backgroundColor: 'transparent' }, },
            }
          }
        }
      };

      const s = document.createElement('script');
      s.src = 'https://cdn.tailwindcss.com';
      s.referrerPolicy = 'no-referrer';
      document.head.appendChild(s);
      console.info('[tailwind] använder CDN-fallback');
    }

    if (FORCE_CDN) {
      loadCdn();
      return;
    }

    const link = document.getElementById('tw-built');

    // FIX: Add a null-check to prevent a crash if the element isn't in the DOM when the script runs.
    if (!link) {
        // If the link tag is missing, assume it's a preview environment and load the CDN directly.
        loadCdn();
        return;
    }

    // Om länken 404:ar eller inte kan läsas ➜ fallback
    link.addEventListener('error', loadCdn);

    // Om “byggd” CSS laddades men innehåller 0 regler (dvs. inte processad) ➜ fallback
    setTimeout(function () {
      try {
        const sheet = [...document.styleSheets].find(ss => ss.ownerNode === link);
        const ok = sheet && sheet.cssRules && sheet.cssRules.length > 0;
        if (!ok) loadCdn();
        else     console.info('[tailwind] använder byggd CSS');
      } catch {
        // Säkerhetsfel i vissa miljöer ➜ ta CDN
        loadCdn();
      }
    }, 600);
  })();
  </script>

  <!-- Import map för ESM-bibliotek -->
  <script type="importmap">
{
  "imports": {
    "react/": "https://esm.sh/react@^19.1.0/",
    "react": "https://esm.sh/react@^19.1.0",
    "react-dom/": "https://esm.sh/react-dom@^19.1.0/",
    "@google/genai": "https://esm.sh/@google/genai",
    "html2canvas": "https://esm.sh/html2canvas@^1.4.1",
    "chart.js/auto": "https://esm.sh/chart.js@^4.4.3/auto",
    "chartjs-adapter-date-fns": "https://esm.sh/chartjs-adapter-date-fns@^3.0.0",
    "chart.js/": "https://esm.sh/chart.js@^4.5.0/",
    "jsqr": "https://esm.sh/jsqr@^1.4.0",
    "qrcode": "https://esm.sh/qrcode@^1.5.3",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js",
    "firebase/functions": "https://www.gstatic.com/firebasejs/10.12.2/firebase-functions.js",
    "firebase-functions/": "https://aistudiocdn.com/firebase-functions@^6.4.0/",
    "firebase-admin/": "https://aistudiocdn.com/firebase-admin@^13.5.0/",
    "express": "https://aistudiocdn.com/express@^5.1.0",
    "cors": "https://aistudiocdn.com/cors@^2.8.5",
    "@google/generative-ai": "https://aistudiocdn.com/@google/generative-ai@^0.24.1",
    "firebase/": "https://aistudiocdn.com/firebase@^12.4.0/"
  }
}
</script>

</head>
<body class="bg-gray-100 text-gray-800 antialiased" style="background-color: #f3f4f6;">
  <div id="root"></div>

  <!-- Vite entry -->
  <script type="module" src="/index.tsx"></script>

  <!-- OBS! Ingen SW-registrering här.
       Service worker registreras endast i index.tsx när import.meta.env.PROD är true. -->
</body>
</html>